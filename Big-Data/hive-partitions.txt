create table orders_w_partition(
  id string,
  customer_id string,
  product_id string,
  quantity int,
  amount double,
  zipcode char(5)
)
partitioned by (state char(2))
row format delimited fields terminated by ',';


/* Load data from a local directory to a Hive table */
load data local inpath '/home/cloudera/Desktop/shared/week5_datasets/order_ct.csv'
into table orders_w_partition
partition (state="CT");

/* See the various paritions that have been created */
show partitions orders_w_partition;

/* Look for data only in one partitioned folder */
select id, state, customer_id, product_id from orders_w_partition where state = "CA";


/* Set dynamic properties to true */
SET hive.exec.dynamic.partition=true;
SET hive.exec.dynamic.partition.mode=nonstrict;


/* Insert into an empty paritioned table from a non-partitioned table */
insert into table orders
partition (state)
select * from orders_no_partition;


/* Load data into a regular table */
load data local inpath '/home/cloudera/Desktop/shared/week5_datasets/newproducts.csv'
into table products_no_buckets;

/* create a Hive table with buckets */
create table products_w_buckets(
id int,
name string,
cost double,
category string
)
CLUSTERED BY (id) INTO 4 BUCKETS;

/* Load data from a regular Hive table to a bucketed Hive table */
from products_no_buckets
insert into table products_w_buckets
select id, name, cost, category;

/* Get a sample of the data from a bucket in Hive */
select * from products_w_buckets TABLESAMPLE(bucket 1 out of 4);
